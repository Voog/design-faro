!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e,t,a,o;e=jQuery,t=function(t,a){a>=.5?e(t).addClass("light-background").removeClass("dark-background"):e(t).addClass("dark-background").removeClass("light-background")},a=function(t,a){var o=function(t,a){if(t&&a){"string"==typeof t&&(t=t.replace(/rgba?\(/,"").replace(/\)/,"").split(","),e.each(t,(function(e,a){t[e]=+a}))),"string"==typeof a&&(a=a.replace(/rgba?\(/,"").replace(/\)/,"").split(","),e.each(a,(function(e,t){a[e]=+t}))),"object"==typeof t&&t.hasOwnProperty("length")&&3==t.length&&t.push(1),"object"==typeof a&&a.hasOwnProperty("length")&&3==a.length&&a.push(1);var o=[0,0,0,0];return o[3]=1-(1-a[3])*(1-t[3]),0===o[3]&&(o[3]=1e-6),o[0]=Math.min(a[0]*a[3]/o[3]+t[0]*t[3]*(1-a[3])/o[3],255),o[1]=Math.min(a[1]*a[3]/o[3]+t[1]*t[3]*(1-a[3])/o[3],255),o[2]=Math.min(a[2]*a[3]/o[3]+t[2]*t[3]*(1-a[3])/o[3],255),e.map(o,(function(e){return Math.floor(e)}))}}(t||[255,255,255,1],a||[255,255,255,1]);return o},o=function(e,t){var o=a(e,t);return Math.round((.2126*+o[0]+.7152*+o[1]+.0722*+o[2])/2.55)/100},window.site=e.extend(window.site||{},{bgPickerPreview:function(a,s,i){var n=e(a).css("background-image"),r=s.imageSizes?function(e,t){for(var a,o=0,s=e.length;o<s;o++){if(e[o].width<t)return a||e[o];a=e[o]}return e[e.length-1]}(s.imageSizes,e(window).width()):null,c=s.image&&""!==s.image?`url(${r.url})`:"none",l=s.imageSizes&&""!==s.imageSizes?s.imageSizes:null,d=s.color&&""!==s.color?s.color:"rgba(0,0,0,0)";!s.colorData||""===s.colorData||s.colorData.lightness;var g,u=e("<img>"),f=e("<canvas>"),m=s.image&&""!==s.image?s.image:null;m?function(e,t){for(var a=e.length;a--;)if(t.indexOf(e[a].url.trim())>-1)return!0;return!1}(l,n)?(i.imageColor=i.imageColor?i.imageColor:defaultImageColor,i.combinedLightness=o(i.imageColor,d),t(a,i.combinedLightness)):(u.attr("src",m.replace(/.*\/(photos|voogstock)/g,"/photos")),u.on("load",(function(){ColorExtract.extract(u[0],f[0],(function(e){i.imageColor=e.bgColor?e.bgColor:"rgba(255,255,255,1)",i.combinedLightness=o(i.imageColor,d),t(a,i.combinedLightness)}))}))):(i.imageColor="rgba(255,255,255,1)",i.combinedLightness=o(i.imageColor,d),t(a,i.combinedLightness)),g=s.colorData?`${s.colorData.r},${s.colorData.g},${s.colorData.b}`:"255,255,255",e(":root").css(`--${s.variableName}`,d),e(":root").css(`--${s.variableName}-rgb`,g),e(a).find(".js-background-image").first().css({"background-image":c})},bgPickerCommit:function({bgPicker:t,blockData:a,blockKey:o,data:s,dataBgKey:i,dataKey:n,pageType:r}){var c,l=e.extend(!0,{},s);if(l.image=s.image||"",l.imageSizes=null==(c=s.imageSizes)||"string"==typeof c&&c.match(/^[\\'"]+$/)?"":c,l.color=s.color||"",l.combinedLightness=t.combinedLightness,"faro_body_blocks"===i&&o&&n){const e=a.find((e=>String(e.key)===String(o)));e&&(e[n]=l),l=a}return"articlePage"===r?Edicy.articles.currentArticle.setData(i,l):"productPage"===r?siteData.set(i,l):pageData.set(i,l),l},bindBlockActions:({bodyBlocks:t,dataKey:a,deleteConfirmation:o})=>{e(document).ready((()=>{(({bodyBlocks:t,dataKey:a})=>{e(".js-add-block").on("click",(e=>{const o=e.target.dataset.blockLayout,s=t.map((e=>e.key));let i=String(s.length+1);if(s.includes(String(i)))for(let e=1;e<100;e++){if(!s.includes(`${i}-${e}`)){i=`${i}-${e}`;break}if(99===e)return void console.error("Could not find unique key for new block")}t.push({key:i,layout:o}),pageData.set(a,t,{success:()=>{location.reload()}})}))})({bodyBlocks:t,dataKey:a}),(({bodyBlocks:t,dataKey:a,deleteConfirmation:o})=>{e(".js-delete-button").on("click",(s=>{if(confirm(o)){const o=s.target.dataset.key,i=t.find((e=>String(e.key)===String(o))),n=t.indexOf(i);t.splice(n,1),pageData.set(a,t,{success:()=>{e(`.${s.target.dataset.wrapperClass}`).filter(`[data-block-key="${o}"]`).remove()}})}}))})({bodyBlocks:t,dataKey:a,deleteConfirmation:o}),(({bodyBlocks:t,dataKey:a})=>{e(".js-move-button").on("click",(o=>{const s=e(`.${o.target.dataset.wrapperClass}`),i=o.target.dataset.key,n=o.target.dataset.direction,r=t.find((e=>String(e.key)===String(i))),c=s.filter(`[data-block-key="${i}"]`),l=t.indexOf(r);if("up"===n&&l>0){const o=l-1,i=s[o];t.splice(o,0,t.splice(l,1)[0]),pageData.set(a,t,{success:()=>{c.insertBefore(e(i))}})}else if("down"===n&&l+1<t.length){const o=l+1,i=s[o];t.splice(o,0,t.splice(l,1)[0]),pageData.set(a,t,{success:()=>{c.insertAfter(e(i))}})}}))})({bodyBlocks:t,dataKey:a}),(({bodyBlocks:t,dataKey:a})=>{e(".js-blocks-wrapper").on("mouseenter",(t=>{e(t.target).closest(".js-blocks-wrapper").first().addClass("active")})),e(".js-change-layout-select").on("click",(t=>{e(t.target).closest(".js-blocks-wrapper").first().addClass("active")})),e(".js-blocks-wrapper").on("mouseleave",(t=>{e(t.target).closest(".js-blocks-wrapper").first().removeClass("active")})),e(".js-change-layout-select").on("change",(o=>{const s=e(o.target).find(":selected").data("key"),i=o.target.value;t.find((e=>String(e.key)===String(s))).layout=i,pageData.set(a,t,{success:()=>{location.reload()}})}))})({bodyBlocks:t,dataKey:a}),(({bodyBlocks:t,dataKey:a})=>{e(".js-settings-checkbox").on("change",(o=>{const s=o.target.dataset.key,i=o.target.dataset.setting,n=t.find((e=>String(e.key)===String(s))),r=e(`[data-block-key="${s}"]`);n.settings=n.settings||{},n.settings[i]=o.target.checked,pageData.set(a,t),r.find(".block").each(((t,a)=>{e(a).toggleClass(i.replace(/_/g,"-"),o.target.checked)}))}))})({bodyBlocks:t,dataKey:a})}))},bindFrontPageLayoutChange:({currentData:t,key:a})=>{e(".js-change-layout-select").on("change",(e=>{const o=e.target.value;t.layout=o,pageData.set(a,t,{success:()=>{location.reload()}})}))}}),window.edy=window.edy||[],edy.push(["texteditorStyles",{name:"Button",tagname:"a",attribute:{href:"#"},classname:"custom-btn",toggle:!0}]),e(".js-data-item").each((function(){e(this).on("change",(function(e){if("checkbox"===e.target.type)var t=e.target.checked;else t=e.target.value;var a=e.target.dataset.name,o=e.target.dataset.id,s=e.target.dataset.entity,i=e.target.dataset.reload;if("site"==s)var n=new Edicy.CustomData({type:"site"});else n=new Edicy.CustomData({type:s,id:o});n.set({[a]:t},{success:function(){i&&location.reload()}})}))})),e(".form_field-cms input").length&&(e(".form_field-cms input").val().length>=1?e(".form_field-cms input").closest(".form_field-cms").addClass("with-input"):e(".form_field-cms input").closest(".form_field-cms").removeClass("with-input")),e(document).ready((function(){e(".form_field-cms input").keyup((function(t){e(this).val().length>=1?e(this).closest(".form_field-cms").addClass("with-input"):e(this).closest(".form_field-cms").removeClass("with-input")}))}))}));
